import{d as c,e as E,h as w,i as h,s as v,t as x,v as P,w as N}from"./chunk-C6QEJELF.js";async function C(e,t){if(!t)throw new Error("No token provided");let r=await fetch(e,{headers:{Authorization:`Bearer ${t}`}}),n=await r.json();if(!r.ok)throw new Error(n?.detail?.message||"Unknown Error");return n}function p(e,t,r){return v(t&&e?t:null,async o=>{if(o==="local")return r([]);let d=await C(o,e||"");return r(d)},{shouldRetryOnError:!0})}function R(e,t){let r=N.getConfig(t);return p(e,e?r.modelsUrl:null,r.mapModelsResponse)}var a=c(E()),m=c(w());var f=c(w());async function A(e,t){try{if(!e||!t){let o=await f.default.storage.local.get({"deepseek-login":"","deepseek-password":""});e=o["deepseek-login"],t=o["deepseek-password"]}let r=await fetch(P.loginUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,mobile:"",area_code:"",device_id:"",os:"web"})}),n=await r.json();if(r.ok&&n?.data?.user){let o=n.data.user.token;return await f.default.storage.local.set({"deepseek-token":o,"deepseek-login":e,"deepseek-password":t}),{token:o}}else return{error:"Invalid username or password"}}catch(r){return console.error("Login error",r),{error:"An error occurred during login"}}}var s=c(h());function D({onLoginStatusChange:e,callback:t}){let[r,n]=(0,a.useState)(""),[o,d]=(0,a.useState)(""),[u,y]=(0,a.useState)(!1),[k,b]=(0,a.useState)(null),[l,g]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{(async()=>{let i=await m.default.storage.local.get({"deepseek-login":"","deepseek-password":""});i["deepseek-login"]&&i["deepseek-password"]?(n(i["deepseek-login"]),d(i["deepseek-password"]),g(!0),e&&e(!0)):e&&e(!1)})()},[e]),(0,s.jsxs)("div",{className:"flex flex-col gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium leading-6 text-gray-900 dark:text-gray-200",children:"Email"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("input",{type:"text",name:"username",id:"username",value:r,onChange:i=>n(i.target.value),disabled:l,required:!0,className:`block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm 
              ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 
              focus:ring-inset focus:ring-primary-600 disabled:bg-gray-100 disabled:text-gray-500
              sm:text-sm sm:leading-6`})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900 dark:text-gray-200",children:"Password"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("input",{type:"password",name:"password",id:"password",value:o,onChange:i=>d(i.target.value),disabled:l,required:!0,className:`block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm
              ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2
              focus:ring-inset focus:ring-primary-600 disabled:bg-gray-100 disabled:text-gray-500
              sm:text-sm sm:leading-6`})})]}),k&&(0,s.jsx)("div",{className:"text-red-500",children:k}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[!l&&(0,s.jsx)("button",{type:"button",onClick:async()=>{if(l)return;y(!0),b(null);let i=await A(r,o);"token"in i?(await m.default.storage.local.set({"deepseek-login":r,"deepseek-password":o,"deepseek-token":i.token}),g(!0),e&&e(!0),t&&t()):b(i.error),y(!1)},disabled:u,className:`items-center rounded-md border border-transparent bg-primary-500
              px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700
              focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
              disabled:cursor-not-allowed disabled:bg-primary-300 disabled:opacity-50`,children:u?(0,s.jsx)(x,{style:"flex h-5 w-5 items-center justify-center"}):"Login"}),l&&(0,s.jsx)("button",{type:"button",onClick:async()=>{await m.default.storage.local.remove(["deepseek-login","deepseek-password","deepseek-token"]),n(""),d(""),g(!1),e&&e(!1)},className:`items-center rounded-md border border-transparent bg-red-500
              px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-700
              focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,children:"Remove Account"})]})]})}var J=D;export{R as a,J as b};
